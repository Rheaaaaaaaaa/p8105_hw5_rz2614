---
title: "hw5"
author: "Ruihan Zhang"
date: "2022-11-16"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(p8105.datasets)
library(viridis)
library(dplyr)
library(purrr)
library(broom)
```

```{r}
homicide= read_csv("./homicide-data.csv") %>% 
  janitor::clean_names() %>% 
  mutate(city_state = paste(homicide$city, homicide$state))
  
```
```{r}
homicides_number =  homicide %>% 
  group_by(city) %>% 
  summarise(homicides_no = n())
unsolved = homicide %>% 
  group_by(city)  %>% 
  filter(., disposition == "Closed without arrest" | disposition == "Open/No arrest" ) %>% summarise(unsolved_no = n())
sum = merge(homicides_number, unsolved, by = "city")

```

```{r}
sink("test_output")
test = prop.test(x = 1825, n = 2827) 
sink()
tidy = broom::tidy(test)
tidy
```

```{r}
pt = sum %>% 
  mutate(value = map2(unsolved_no, homicides_no, ~ prop.test(.x, .y) %>% 
  tidy())) %>% 
  unnest(value) %>% 
  select(., city, homicides_no, unsolved_no, estimate, conf.low, conf.high)
```

```{r}
p = ggplot(pt, aes(estimate, colour = city)) + geom_errorbar(aes(ymin = conf.low, ymax = conf.high),width = 0.2) + labs(title = "the estimates and CIs for each city",
    x = "esitimates",
    y = "confidential interval")
```

```{r}

sim_mean_sd = function(n, mu = 0, sigma = 5) {
  
  sim_data = tibble(
    x = rnorm(30, mean = mu, sd = sigma),
  )
  
  tt = t.test(sim_data) %>% 
    broom::tidy() %>% 
    select(estimate, p.value)
  tt
}
rerun(5000, sim_mean_sd(30, 0, 5)) %>% 
    bind_rows
```

